// =====================================
// 1. Variabili di Configurazione (Tempi, Easing, Valori)
// =====================================

// Durate comuni delle transizioni
$duration-standard: 300ms;
$duration-fast: 200ms;
$duration-slow: 400ms;
$duration-toolbar-row-hidden: 66ms;
$duration-toolbar-row-visible: 280ms;

// Funzioni di easing (prese dalle tue var CSS)
$ease-decelerate: var(--mat-sys-motion-emphasized-decelerate);
$ease-accelerate: var(--mat-sys-motion-emphasized-accelerate);

// Ritardo comune per elementi in lista
$delay-list-item: calc(20ms * var(--index, 0));
$delay-toolbar-row-visible: 66ms;

// Valori di trasformazione comuni
$transform-y-up: translateY(-5rem);
$transform-y-down: translateY(5rem);
$transform-x-left: translateX(-5rem);
$transform-y-list-item: translateY(1.5rem);
$transform-scale-min: scale(0.4);

// =====================================
// 2. Mixin Riutilizzabili
// =====================================

// Mixin per le transizioni standard di ingresso (opacità e trasformazione)
@mixin enter-transition(
  $delay: $delay-list-item,
  $duration: $duration-standard,
  $ease: $ease-decelerate
) {
  transition:
    opacity $duration $ease $delay,
    transform $duration $ease $delay,
    box-shadow $duration $ease $delay; // box-shadow solo per il primo blocco, da valutare se generalizzare
}

// Mixin per le transizioni di uscita (scalatura e opacità)
@mixin exit-transition($duration: $duration-standard, $ease: $ease-accelerate) {
  transition-duration: $duration;
  transition-timing-function: $ease;
  opacity: 0;
  transform: $transform-scale-min;
}

// Mixin per lo stato @starting-style di ingresso standard
@mixin starting-style-enter($initial-transform: $transform-y-list-item) {
  @starting-style {
    opacity: 0;
    transform: $initial-transform;
  }
}

// Mixin per lo stato @starting-style di uscita standard (per opacity e transform)
@mixin starting-style-exit($initial-opacity: 1, $initial-transform: scale(1)) {
  @starting-style {
    opacity: $initial-opacity;
    transform: $initial-transform;
  }
}

// Mixin per le transizioni della toolbar interna
@mixin toolbar-row-transition(
  $duration: $duration-toolbar-row-visible,
  $delay: 0ms,
  $ease: $ease-decelerate
) {
  transition: opacity $duration $ease $delay;
}

// =====================================
// 3. Applicazione degli Stili Refactorizzati
// =====================================

@mixin transitions() {
  // --- Elementi della tabella e card ---
  .mat-mdc-row,
  .mat-mdc-header-row,
  .mat-mdc-footer-row,
  .mat-mdc-card,
  .list-item-transition .mat-mdc-list-item,
  .list-item-transition content-loader .lineup-disposition .mat-mdc-select,
  .lineup-disposition .mat-mdc-form-field-subscript-wrapper {
    @include enter-transition; // Applica transizione standard di ingresso
    @include starting-style-enter; // Applica @starting-style standard di ingresso
  }

  // --- Contenitore "create-box" e i suoi figli animati ---
  .create-box {
    & > img,
    .mat-icon,
    .img-container,
    .mat-empty-state,
    .icon-container > span {
      transition:
        opacity $duration-standard $ease-decelerate $delay-list-item,
        transform $duration-standard $ease-decelerate $delay-list-item; // Solo opacity e transform qui

      opacity: 1; // Stato finale visibile

      @include starting-style-exit(
        $initial-opacity: 0,
        $initial-transform: $transform-scale-min
      ); // Iniziale: scalato e trasparente
    }

    // Stato "deleting" per gli elementi interni di create-box
    &.deleting {
      & > img,
      .mat-icon,
      .img-container,
      .mat-empty-state,
      .icon-container > span {
        opacity: 0;
        transform: $transform-scale-min;
        transition-timing-function: $ease-accelerate; // Easing specifico per l'uscita
      }
    }
  }

  // --- Scorrimento (scroll-up/scroll-down) ---
  .stable .scroll-up,
  .stable .scroll-down {
    transition-property: transform; // Solo transform per il contenitore

    .mat-toolbar-row {
      transition-property: opacity; // Solo opacity per la toolbar interna
    }

    // Stato visibile per scroll-up/down
    &.scroll-up-visible,
    &.scroll-down-visible {
      transition-duration: $duration-slow;
      transition-timing-function: $ease-decelerate;
      transform: translateY(0); // Posizione finale visibile

      .mat-toolbar-row {
        @include toolbar-row-transition(
          $delay: $delay-toolbar-row-visible
        ); // Transizione di ingresso toolbar

        opacity: 1; // Opacità finale visibile

        @include starting-style-exit(
          $initial-opacity: 0,
          $initial-transform: null
        ); // Parte da opacità 0
      }
    }

    // Stato nascosto per scroll-up/down
    &.scroll-up-hidden,
    &.scroll-down-hidden {
      transition-duration: $duration-fast;
      transition-timing-function: $ease-accelerate;

      @include starting-style-exit(
        $initial-opacity: null,
        $initial-transform: translateY(0)
      ); // Parte dalla posizione visibile

      .mat-toolbar-row {
        @include toolbar-row-transition(
          $duration: $duration-toolbar-row-hidden,
          $ease: $ease-accelerate
        ); // Transizione di uscita toolbar

        opacity: 0; // Opacità finale nascosta

        @include starting-style-exit(
          $initial-opacity: 1,
          $initial-transform: null
        ); // Parte da opacità 1
      }
    }
  }

  // --- Posizioni specifiche per scroll-up/down (fuori dal blocco principale per chiarezza sullo stato finale) ---
  .scroll-up-visible {
    @include starting-style-exit(
      $initial-opacity: null,
      $initial-transform: -100%
    ); // Assume un translateY(-100%) come stato iniziale
  }

  .scroll-up-hidden {
    transform: translateY(-100%); // Posizione finale quando nascosto
  }

  .scroll-down-visible {
    @include starting-style-exit(
      $initial-opacity: null,
      $initial-transform: 100%
    ); // Assume un translateY(100%) come stato iniziale
  }

  .scroll-down-hidden {
    transform: translateY(100%); // Posizione finale quando nascosto
  }

  // --- Chiusura (close) ---
  .close {
    transition-property: transform;

    &.close-visible {
      transition-duration: $duration-slow;
      transition-timing-function: $ease-decelerate;
      transform: scale(1); // Stato finale visibile

      @include starting-style-exit(
        $initial-opacity: null,
        $initial-transform: scale(0)
      ); // Parte da scalato a 0
    }

    &.close-hidden {
      transition-duration: $duration-fast;
      transition-timing-function: $ease-accelerate;
      transform: scale(0); // Stato finale nascosto

      @include starting-style-exit(
        $initial-opacity: null,
        $initial-transform: scale(1)
      ); // Parte da scalato a 1
    }
  }

  // --- Navigazione (navigation) ---
  .mat-drawer-container {
    .mat-mdc-nav-list > *,
    app-profile,
    .toggle,
    .fab {
      transition:
        transform 500ms $ease-decelerate $delay-list-item,
        opacity 500ms $ease-decelerate $delay-list-item;
    }

    &.container-navigation-rail,
    &.container-navigation-drawer {
      .mat-mdc-nav-list > *,
      app-profile,
      .toggle,
      .fab {
        @include starting-style-exit(
          $initial-opacity: 0,
          $initial-transform: $transform-x-left
        ); // Parte da sopra e trasparente
      }
    }

    &.container-navigation-bar {
      .mat-mdc-nav-list[direction='down'] > *,
      app-profile,
      .toggle,
      .fab {
        @include starting-style-exit(
          $initial-opacity: 0,
          $initial-transform: $transform-x-left
        ); // Parte da sinistra e trasparente
      }

      .mat-mdc-nav-list[direction='right'] > * {
        @include starting-style-exit(
          $initial-opacity: 0,
          $initial-transform: $transform-y-down
        ); // Parte da sotto e trasparente
      }
    }
  }
}
