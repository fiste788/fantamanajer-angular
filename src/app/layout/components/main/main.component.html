@let _size = size();
@let _isScrolled = isScrolled();
@let _showTopAppBar = showTopAppBar();
@let _stable = stable();
<mat-sidenav-container>
  <mat-sidenav
    autoFocus="false"
    fixedInViewport="true"
    [attr.role]="_size === 'handset' ? 'dialog' : 'navigation'"
    [attr.old-size]="stabilized$ | async"
    [mode]="_size === 'web' ? 'side' : 'over'"
    [(opened)]="openSidebar"
  >
    @defer (on viewport) {
      <app-navigation-drawer />
    } @placeholder (minimum 500ms) {
      <app-navigation-drawer-skeleton />
    }
  </mat-sidenav>
  <mat-sidenav-content>
    <app-top-app-bar
      [@scrollUpAnimation]="!_isScrolled || _showTopAppBar"
      [ngClass]="{ 'is-scrolled': _isScrolled }"
    />
    <main
      [@contextChange]="o | state"
      [style.viewTransitionName]="viewTransitionName()"
    >
      <router-outlet #o="outlet" />
    </main>

    <div
      class="bottom"
      [@scrollDownAnimation]="_stable && _showTopAppBar ? _showTopAppBar : hidden"
    >
      @defer (when _size === 'handset') {
        <app-navigation-bar />
      }
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
